<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agent TARS</title>
    <script type="text/javascript">
      // SPA (Single Page Application) Redirect Handler Script
      (function () {
        // First, try to restore any redirected route from sessionStorage
        var redirect = sessionStorage.redirect;
        delete sessionStorage.redirect;
        
        if (redirect && redirect !== location.href) {
          history.replaceState(null, null, redirect);
          return; // Exit early if we've restored from session
        }
        
        // Process URL parameters from 404.html redirect
        var l = window.location;
        if (l.search) {
          // Parse all query parameters into an object
          var q = {};
          l.search
            .slice(1)
            .split("&")
            .forEach(function (v) {
              var a = v.split("=");
              q[a[0]] = a.length > 1 ? decodeURIComponent(a[1]) : "";
            });
          
          // Check if this is a redirect from 404.html (contains 'p' parameter)
          if (q.p !== undefined) {
            // Reconstruct the original URL correctly
            var path = q.p || '';
            var newPath = path ? '/' + path : '/';
            
            // Add back any query parameters from the original request
            if (q.q) {
              newPath += '?' + q.q;
            }
            
            // Add back any hash fragment
            if (l.hash) {
              newPath += l.hash;
            }
            
            // Replace the current URL with the reconstructed one without storing in session
            history.replaceState(null, null, newPath);
          }
        }
      })();
    </script>
  </head>
  <body>
    <div id="<%= mountId %>"></div>
  </body>
</html>
